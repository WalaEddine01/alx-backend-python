#!/bin/bash

# Script: kubctl-0x02
# Objective: Deploy blue and green versions, switch traffic, and check logs

echo "ğŸš€ Deploying BLUE version..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "ğŸš€ Deploying GREEN version..."
kubectl apply -f messaging_app/green_deployment.yaml

echo "ğŸ” Deploying service routing to BLUE..."
kubectl apply -f messaging_app/kubeservice.yaml

echo "â³ Waiting for pods to start..."
sleep 10

echo "ğŸ“¦ Verifying running pods:"
kubectl get pods -l app=django

echo "ğŸ“„ Checking logs for GREEN deployment:"
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath="{.items[0].metadata.name}")
kubectl logs "$GREEN_POD"

echo "ğŸŸ¢ To switch traffic to GREEN, edit 'kubeservice.yaml' selector to:"
echo "    version: green"
echo "Then reapply with:"
echo "    kubectl apply -f messaging_app/kubeservice.yaml"
